<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lune de Miel - Japon & Philippines</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå∏</text></svg>">
    
    <!-- Leaflet CSS & FontAwesome -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <meta name="theme-color" content="#e91e63">

    <style>
        /* --- DESIGN SYSTEM --- */
        :root {
            --primary: #e91e63;
            --secondary: #2196f3;
            --japan: #bc002d;
            --philippines: #0038a8;
            --success: #4caf50;
            --suggestion: #ff9800;
            --text: #333;
            --bg: #f8f9fa;
            --gradient-jp-ph: linear-gradient(135deg, var(--japan) 0%, var(--philippines) 100%);
            --radius: 16px;
            --font-main: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif;
            --header-height: 60px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: var(--font-main); 
            background: var(--bg); 
            color: var(--text); 
            overflow-x: hidden; 
            padding-bottom: 90px;
            font-size: 16px;
        }
        
        /* --- LANDING PAGE --- */
        #landing-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: var(--gradient-jp-ph);
            z-index: 2000; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: white;
            text-align: center; transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .btn-enter {
            padding: 18px 45px; background: white; color: var(--philippines);
            border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold;
            cursor: pointer; margin-top: 40px; transition: transform 0.2s; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        }
        .btn-enter:active { transform: scale(0.95); }

        /* COUNTDOWN */
        .countdown-container { display: flex; gap: 10px; margin-top: 30px; justify-content: center; }
        .countdown-box {
            background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(10px);
            padding: 12px 10px; border-radius: 12px; min-width: 75px;
            border: 1px solid rgba(255,255,255,0.4);
        }
        .countdown-number { font-size: 1.8rem; font-weight: 800; display: block; line-height: 1.1; }
        .countdown-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.95; font-weight: 600; }
        
        /* --- APP LAYOUT --- */
        #app-interface { display: none; opacity: 0; transition: opacity 0.5s; }
        
        header {
            position: sticky; top: 0; z-index: 1000;
            background: var(--gradient-jp-ph); color: white;
            height: var(--header-height); padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        }
        
        /* SIDEBAR */
        #sidebar {
            position: fixed; top: 0; left: -100%; width: 85%; max-width: 300px; height: 100vh;
            background: white; z-index: 1500; transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 2px 0 20px rgba(0,0,0,0.2); padding-top: var(--header-height);
        }
        #sidebar.active { left: 0; }
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: rgba(0,0,0,0.6); z-index: 1400; display: none; backdrop-filter: blur(2px);
        }
        .nav-link {
            display: flex; align-items: center; padding: 20px 25px;
            color: var(--text); text-decoration: none; border-bottom: 1px solid #f0f0f0;
            font-weight: 500; font-size: 1.1rem;
        }
        .nav-link i { width: 35px; color: var(--primary); font-size: 1.2rem; }
        .nav-link:active { background: #f8f9fa; }
        
        /* SECTIONS */
        .section { display: none; padding: 20px 15px; max-width: 800px; margin: 0 auto; }
        .section.active { display: block; animation: fadeIn 0.4s; }
        
        /* --- PLANNING --- */
        .day-nav {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; margin-top: 10px; background: white; padding: 5px;
            border-radius: 50px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .day-nav button {
            background: none; border: none; font-size: 1.5rem; width: 44px; height: 44px;
            display: flex; align-items: center; justify-content: center; color: var(--primary);
            border-radius: 50%; cursor: pointer;
        }
        .day-nav button:active { background: #eee; }
        #day-select {
            border: none; background: transparent; font-size: 1rem; font-weight: bold;
            color: var(--text); text-align: center; width: 100%; outline: none;
        }

        .day-card {
            background: white; border-radius: var(--radius); overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08); margin-bottom: 25px;
            transition: transform 0.2s ease-out, opacity 0.2s ease-out; 
        }
        .day-header { padding: 25px 20px; color: white; display: flex; justify-content: space-between; align-items: center; }
        .bg-jp { background: var(--japan); }
        .bg-ph { background: var(--philippines); }
        .bg-intl { background: #607d8b; }
        
        /* OVERVIEW (VUE D'ENSEMBLE CARROUSEL) */
        #overview { max-width: 100% !important; padding: 20px 0 !important; }
        #overview h2, .overview-controls, .landscape-hint { max-width: 800px; margin-left: auto; margin-right: auto; padding: 0 15px; }
        
        .overview-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .overview-grid { 
            display: flex; 
            overflow-x: auto; 
            gap: 15px; 
            padding: 10px 15px 30px 15px; 
            scroll-behavior: smooth; 
            -webkit-overflow-scrolling: touch;
            scroll-snap-type: x mandatory;
        }
        
        .overview-day {
            flex: 0 0 85%; 
            background: white; border-radius: 12px; padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-left: 5px solid var(--primary);
            display: flex; flex-direction: column;
            scroll-snap-align: center;
            min-height: 280px;
            transition: transform 0.2s;
        }
        
        @media (min-width: 768px) or (orientation: landscape) {
            .overview-day { flex: 0 0 28%; scroll-snap-align: start; }
        }
        @media (min-width: 1024px) {
            .overview-day { flex: 0 0 23%; }
        }

        .overview-date { font-weight: bold; color: var(--primary); margin-bottom: 5px; font-size: 1.1rem; }
        .overview-loc { font-size: 0.9rem; color: #666; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .overview-split-header { font-size: 0.75rem; text-transform: uppercase; color: #999; font-weight: bold; margin-top: 8px; margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }
        .overview-act-list { list-style: none; padding: 0; margin: 0; }
        .overview-act-item { font-size: 0.85rem; margin-bottom: 4px; display: flex; gap: 6px; line-height: 1.3; }
        .overview-act-item::before { content: '‚Ä¢'; color: var(--secondary); font-weight: bold; }
        .overview-empty-slot { font-size: 0.75rem; color: #ccc; font-style: italic; margin-left: 10px; }
        .landscape-hint { background: #e3f2fd; color: #0d47a1; padding: 10px; border-radius: 8px; margin-bottom: 15px; text-align: center; font-size: 0.9rem; display: none; }
        @media (orientation: portrait) { .landscape-hint { display: block; } }

        /* FLIGHTS SECTION */
        .flight-trip-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 25px; }
        .flight-trip-header { background: #f1f5f9; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e2e8f0; }
        .flight-trip-title { font-weight: bold; color: var(--secondary); font-size: 1rem; display: flex; align-items: center; gap: 8px; }
        .flight-trip-date { font-size: 0.85rem; color: #64748b; background: white; padding: 4px 10px; border-radius: 20px; }
        .flight-baggage { padding: 12px 20px 0; font-size: 0.85rem; color: #475569; }
        .flight-baggage ul { margin: 8px 0 0; padding: 0; list-style: none; display: flex; flex-direction: column; gap: 8px; }
        .flight-baggage li { line-height: 1.3; display: flex; gap: 10px; align-items: flex-start; }
        .baggage-icons { display: inline-flex; flex-direction: column; gap: 6px; align-items: flex-start; min-width: 70px; }
        .baggage-icon { display: inline-flex; align-items: center; gap: 6px; font-weight: 600; }
        .baggage-icon i { font-size: 1rem; }
        .baggage-pa { color: #1e88e5; }
        .baggage-coralie { color: #ec4899; }
        .baggage-details { color: #334155; }
        .flight-segment { display: flex; padding: 20px; position: relative; }
        .flight-segment:not(:last-child)::after { content: ''; position: absolute; bottom: 0; left: 80px; right: 20px; border-bottom: 1px dashed #e2e8f0; }
        .flight-times-col { display: flex; flex-direction: column; justify-content: space-between; min-width: 60px; text-align: right; padding-right: 15px; border-right: 2px solid var(--primary); position: relative; }
        .flight-time { font-weight: 800; font-size: 1.1rem; color: #333; }
        .flight-time-sub { font-size: 0.75rem; color: #999; }
        .flight-times-col::before, .flight-times-col::after { content: ''; position: absolute; right: -5px; width: 8px; height: 8px; background: white; border: 2px solid var(--primary); border-radius: 50%; }
        .flight-times-col::before { top: 5px; }
        .flight-times-col::after { bottom: 5px; }
        .flight-info-col { padding-left: 15px; flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .flight-route { font-size: 1rem; font-weight: bold; margin-bottom: 5px; color: #1e293b; }
        .flight-route span { color: var(--primary); margin: 0 5px; }
        .flight-airline { font-size: 0.85rem; color: #64748b; display: flex; align-items: center; gap: 5px; }
        .flight-badge { background: #e0f2f1; color: #00695c; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; margin-left: auto; }

        /* CHALLENGE CARD */
        .challenge-card {
            margin: 20px; background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white; border-radius: 12px; overflow: hidden;
        }
        .challenge-header { padding: 18px 20px; cursor: pointer; display: flex; align-items: center; gap: 12px; }
        .challenge-body { padding: 0 20px 20px; display: none; }
        .challenge-body.open { display: block; }
        .challenge-card.completed { background: var(--success); }
        
        /* CAMERA INPUT BUTTON */
        .camera-btn-label { display: block; width: 100%; padding: 15px; background: white; color: #333; border-radius: 25px; text-align: center; font-weight: bold; cursor: pointer; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .camera-btn-label:active { transform: scale(0.98); }
        .undo-btn { background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.5); padding: 5px 10px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; margin-left: 10px; }
        .timeline { padding: 10px 20px 25px; }
        .activity { border-left: 3px solid #eee; padding-left: 25px; margin-bottom: 25px; position: relative; }
        .activity:last-child { margin-bottom: 0; }
        .activity::before { content: ''; width: 12px; height: 12px; background: var(--primary); border-radius: 50%; position: absolute; left: -7px; top: 6px; box-shadow: 0 0 0 4px white; }
        
        /* CONVERTER */
        .converter-box { background: white; padding: 30px 20px; border-radius: var(--radius); box-shadow: 0 8px 25px rgba(0,0,0,0.08); text-align: center; display: flex; flex-direction: column; gap: 15px; }
        .currency-row { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        @media (min-width: 480px) { .currency-row { flex-direction: row; } }
        .currency-select { padding: 16px; border: 1px solid #eee; border-radius: 12px; background: #fcfcfc; font-weight: bold; width: 100%; }
        .currency-input { padding: 16px; border: 1px solid #eee; border-radius: 12px; font-size: 1.4rem; font-weight: 500; width: 100%; text-align: center; }
        .btn-update { background: var(--secondary); color: white; border: none; padding: 15px; border-radius: 12px; cursor: pointer; width: 100%; font-weight: bold; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }

        /* H√îTELS - STYLES AJOUT√âS */
        .hotel-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .hotel-action-btn {
            flex: 1;
            min-width: 140px;
            padding: 12px 15px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
        }
        
        .hotel-action-btn:active {
            transform: scale(0.97);
        }
        
        .hotel-call-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }
        
        .hotel-map-btn {
            background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
        }
        
        .hotel-website-btn {
            background: linear-gradient(135deg, #FF9800 0%, #EF6C00 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
        }
        
        /* ANIMATIONS & UTILS */
        @keyframes slideInRight { from { transform: translateX(30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideInLeft { from { transform: translateX(-30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-in-right { animation: slideInRight 0.3s forwards; }
        .slide-in-left { animation: slideInLeft 0.3s forwards; }
        input, select, textarea { font-size: 16px !important; }
        .map-link { text-decoration: none; color: inherit; }
        .hotel-card { background: #fffde7; margin: 20px; padding: 20px; border-radius: 12px; border-left: 6px solid #fbc02d; }
        .hotel-badge { display: inline-block; background: white; padding: 4px 10px; border-radius: 20px; margin-right: 6px; margin-bottom: 6px; font-size: 0.85rem; border: 1px solid rgba(0,0,0,0.05); }
        #map-container { height: 65vh; border-radius: var(--radius); margin-top: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .custom-div-icon { background: transparent; border: none; }
        .marker-pin { width: 30px; height: 30px; border-radius: 50% 50% 50% 0; position: absolute; transform: rotate(-45deg); left: 50%; top: 50%; margin: -15px 0 0 -15px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; }
        .marker-pin::after { content: ''; width: 20px; height: 20px; margin: 5px 0 0 5px; background: #fff; position: absolute; border-radius: 50%; }
        .marker-pin i { transform: rotate(45deg); z-index: 10; font-size: 14px; color: #333; }
        .user-pin { width: 20px; height: 20px; border-radius: 50%; background: #2196f3; border: 3px solid white; box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.3); position: relative; }
        .user-pin::after { content: ''; width: 100%; height: 100%; border-radius: 50%; background: rgba(33, 150, 243, 0.5); position: absolute; top: 0; left: 0; animation: pulse 2s infinite; z-index: -1; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 0.8; } 70% { transform: scale(2.5); opacity: 0; } 100% { transform: scale(1); opacity: 0; } }

        /* VALISE */
        .packing-intro {
            background: #fff;
            padding: 18px;
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        .packing-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 18px;
        }
        @media (min-width: 768px) {
            .packing-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
        .packing-card {
            background: white;
            border-radius: 16px;
            padding: 18px 18px 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border-left: 5px solid var(--primary);
        }
        .packing-card h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .packing-list {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .packing-list li { display: flex; line-height: 1.4; }
        .packing-item {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            cursor: pointer;
            width: 100%;
        }
        .packing-item input {
            margin-top: 3px;
            accent-color: var(--primary);
        }
        .packing-item span {
            transition: color 0.2s ease, text-decoration-color 0.2s ease;
        }
        .packing-item input:checked + span {
            text-decoration: line-through;
            color: #94a3b8;
        }
        .packing-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
        .packing-tag {
            background: #f1f5f9;
            color: #475569;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .packing-note { font-size: 0.85rem; color: #64748b; margin-top: 12px; }

        .lexicon-grid { display:grid; gap:15px; }
        .lexicon-search {
            width: 100%;
            border: 1px solid #dbe2ea;
            border-radius: 12px;
            padding: 12px 14px;
            margin-bottom: 14px;
            font-size: 0.95rem;
            background: #fff;
        }
        .lexicon-search:focus {
            outline: 2px solid rgba(33, 150, 243, 0.25);
            border-color: var(--secondary);
        }
        .lexicon-card { background:white; border-radius:var(--radius); padding:18px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
        .lexicon-card h3 { margin-bottom:10px; color:var(--primary); }
        .lexicon-list { list-style:none; display:flex; flex-direction:column; gap:10px; }
        .lexicon-list li { font-size:0.95rem; line-height:1.35; padding-left:12px; border-left:3px solid #f1f5f9; }
        .lexicon-list li.hidden { display:none; }
        .lexicon-jp { font-weight:700; color:#111827; display:block; }
        .lexicon-fr { color:#475569; font-size:0.9rem; }
        .lexicon-empty { color:#64748b; font-size:0.9rem; margin-top:8px; display:none; }
    </style>
</head>
<body>

    <!-- SCREEN D'ACCUEIL -->
    <div id="landing-page">
        <div class="landing-content">
            <h1>Lune de Miel</h1>
            <p>Japon & Philippines</p>
            <p style="font-size:1rem; opacity:0.9; margin-top:5px;">20 F√©v - 14 Mars 2026</p>
            <div class="countdown-container" id="countdown-display">
                <div class="countdown-box"><span class="countdown-number" id="cd-days">00</span><span class="countdown-label">Jours</span></div>
                <div class="countdown-box"><span class="countdown-number" id="cd-hours">00</span><span class="countdown-label">Heures</span></div>
                <div class="countdown-box"><span class="countdown-number" id="cd-minutes">00</span><span class="countdown-label">Min</span></div>
            </div>
            <button class="btn-enter" onclick="enterApp()">Commencer l'aventure</button>
        </div>
    </div>

    <!-- INTERFACE PRINCIPALE -->
    <div id="app-interface">
        <header>
            <button onclick="toggleSidebar()" style="background:none;border:none;color:white;font-size:1.5rem;padding:10px;"><i class="fas fa-bars"></i></button>
            <div style="font-weight: bold; font-size: 1.1rem;">Voyage de Noces</div>
            <div id="header-date" style="font-size:0.9rem; font-weight:500;">J-0</div>
        </header>

        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
        <nav id="sidebar">
            <button onclick="toggleSidebar()" style="position:absolute;top:15px;right:15px;background:none;border:none;font-size:1.8rem;padding:10px;color:#666;">&times;</button>
            <a href="#" class="nav-link" onclick="navigate('planner')"><i class="fas fa-calendar-alt"></i> Planning</a>
            <a href="#" class="nav-link" onclick="navigate('overview')"><i class="fas fa-th-large"></i> Vue Globale</a>
            <a href="#" class="nav-link" onclick="navigate('flights')"><i class="fas fa-plane"></i> Vols</a>
            <a href="#" class="nav-link" onclick="navigate('map')"><i class="fas fa-globe-asia"></i> Carte</a>
            <a href="#" class="nav-link" onclick="navigate('hotels')"><i class="fas fa-hotel"></i> H√©bergements</a>
            <a href="#" class="nav-link" onclick="navigate('packing')"><i class="fas fa-suitcase-rolling"></i> Valise</a>
            <a href="#" class="nav-link" onclick="navigate('converter')"><i class="fas fa-exchange-alt"></i> Convertisseur</a>
            <a href="#" class="nav-link" onclick="navigate('lexicon')"><i class="fas fa-language"></i> Lexique utile</a>
        </nav>

        <!-- 1. PLANNING -->
        <section id="planner" class="section active">
            <div class="day-nav">
                <button onclick="changeDay(-1)"><i class="fas fa-chevron-left"></i></button>
                <select id="day-select" onchange="selectDay(this.value)"></select>
                <button onclick="changeDay(1)"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div id="day-content"></div>
            <p style="text-align:center; color:#999; font-size:0.85rem; margin-top:15px; opacity:0.7;">
                <i class="fas fa-hand-pointer"></i> Glissez pour changer de jour
            </p>
        </section>

        <!-- 2. VUE GLOBALE (OVERVIEW) -->
        <section id="overview" class="section">
            <h2 style="margin-bottom:15px;">Vue d'ensemble</h2>
            <div class="landscape-hint"><i class="fas fa-mobile-alt fa-rotate-90"></i> Pivotez pour mieux voir !</div>
            <div class="overview-controls">
                <button onclick="scrollOverview('left')" style="background:none;border:none;font-size:1.5rem;"><i class="fas fa-arrow-left"></i></button>
                <span id="overview-range-label" style="font-weight:bold; font-size:0.9rem;">Planning Complet</span>
                <button onclick="scrollOverview('right')" style="background:none;border:none;font-size:1.5rem;"><i class="fas fa-arrow-right"></i></button>
            </div>
            <div class="overview-grid" id="overview-container">
                <!-- Injected by JS -->
            </div>
        </section>

        <!-- 3. VOLS -->
        <section id="flights" class="section">
            <h2 style="margin-bottom:15px;">‚úàÔ∏è Vos Vols</h2>
            <div id="flights-container">
                <!-- Injected by JS -->
            </div>
        </section>

        <!-- 4. CARTE -->
        <section id="map" class="section">
            <h2 style="margin-bottom:15px;">üó∫Ô∏è Carte du Voyage</h2>
            <div class="map-legend" style="display:flex; gap:12px; flex-wrap:wrap; margin-bottom:15px; font-size:0.85rem;">
                <span style="display:flex; align-items:center;"><i class="fas fa-circle" style="color:var(--primary); margin-right:5px;"></i> Activit√©s</span>
                <span style="display:flex; align-items:center;"><i class="fas fa-circle" style="color:var(--secondary); margin-right:5px;"></i> H√¥tels</span>
                <span style="display:flex; align-items:center;"><i class="fas fa-circle" style="color:#2196f3; margin-right:5px; border:2px solid white; border-radius:50%;"></i> Moi</span>
            </div>
            <div id="map-container"></div>
        </section>
        
        <!-- 5. H√îTELS -->
        <section id="hotels" class="section">
            <h2 style="margin-bottom:15px;">üè® Vos H√©bergements</h2>
            <div id="hotels-list"></div>
        </section>

        <!-- 6. CONVERTISSEUR -->
        <section id="converter" class="section">
            <h2 style="margin-bottom:15px;">üí± Convertisseur</h2>
            <div class="converter-box">
                <div class="currency-row">
                    <select id="curr-from" onchange="convertCurrency()" class="currency-select">
                        <option value="EUR">EUR (‚Ç¨)</option>
                        <option value="JPY">JPY (¬•)</option>
                        <option value="PHP">PHP (‚Ç±)</option>
                    </select>
                    <input type="number" id="amount-from" value="100" oninput="convertCurrency()" placeholder="Montant" class="currency-input">
                </div>
                
                <button onclick="swapCurrency()" style="background:none; border:none; font-size:1.5rem; margin:5px 0; cursor:pointer; color:var(--primary);">
                    <i class="fas fa-exchange-alt" style="transform: rotate(90deg);"></i>
                </button>
                
                <div class="currency-row">
                    <select id="curr-to" onchange="convertCurrency()" class="currency-select">
                        <option value="JPY">JPY (¬•)</option>
                        <option value="PHP">PHP (‚Ç±)</option>
                        <option value="EUR">EUR (‚Ç¨)</option>
                    </select>
                    <div id="conversion-result" style="flex:1; padding:16px; text-align:center; font-size: 1.6rem; font-weight: 800; color: var(--primary);">---</div>
                </div>

                <div style="margin-top:25px; border-top:1px solid #eee; padding-top:20px; width:100%;">
                    <button onclick="updateRates()" id="btn-update-rates" class="btn-update">
                        <i class="fas fa-sync-alt"></i> Actualiser les taux
                    </button>
                    <p id="rate-info" style="font-size:0.85rem; color:#999; margin-top:12px;">Taux mis √† jour automatiquement</p>
                </div>
            </div>
        </section>

        <!-- 7. VALISE -->
        <section id="packing" class="section">
            <h2 style="margin-bottom: 15px;">üß≥ Liste valise (selon planning)</h2>
            <div class="packing-intro">
                <strong>Bas√© sur :</strong> Tokyo & Kyoto en hiver, Hokkaido (ski √† Furano), Osaka, puis Bohol/Panglao aux Philippines (plages, plong√©e, excursions).
                <div class="packing-note">Astuce : pr√©voyez un sac ¬´ cabine/avion ¬ª pour les vols int√©rieurs et un sac √©tanche pour les sorties en mer.</div>
            </div>
            <div class="packing-grid">
                <div class="packing-card">
                    <h3>‚õ∑Ô∏è Tenue compl√®te de ski (Hokkaido)</h3>
                    <ul class="packing-list">
                        <li><label class="packing-item"><input type="checkbox"><span><strong>Couche 1 (thermique)</strong> : sous-v√™tements thermiques haut + bas (x2 √† x3)</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span><strong>Couche 2 (isolante)</strong> : polaire / doudoune l√©g√®re / laine m√©rinos</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span><strong>Couche 3 (protection)</strong> : veste + pantalon de ski imperm√©ables</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Chaussettes de ski (x3)</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Gants de ski + sous-gants</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Bonnet + tour de cou / cagoule</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Masque de ski + lunettes de soleil cat√©gorie 3</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Cr√®me solaire haute protection + stick l√®vres</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Chaufferettes (mains/pieds)</span></label></li>
                    </ul>
                    <div class="packing-tags">
                        <span class="packing-tag">Furano</span>
                        <span class="packing-tag">Onsen</span>
                        <span class="packing-tag">Ski nocturne</span>
                    </div>
                    <div class="packing-note">Pr√©voir une tenue d√©di√©e √† l'onsen (serviette + tenue propre).</div>
                </div>

                <div class="packing-card">
                    <h3>üèôÔ∏è Japon urbain & temples</h3>
                    <ul class="packing-list">
                        <li><label class="packing-item"><input type="checkbox"><span>Manteau chaud + doudoune l√©g√®re</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Pulls / sweats (x3) + t-shirts manches longues</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Pantalons confortables (x3)</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Chaussures de marche (d√©j√† rod√©es)</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>√âcharpe + bonnet fin</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Tenue plus habill√©e (d√Æner Ginza / Osaka)</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Chaussons / claquettes (h√¥tels, ryokan)</span></label></li>
                    </ul>
                    <div class="packing-tags">
                        <span class="packing-tag">Tokyo</span>
                        <span class="packing-tag">Kyoto</span>
                        <span class="packing-tag">Osaka</span>
                    </div>
                </div>

                <div class="packing-card">
                    <h3>üå¥ Philippines & plages</h3>
                    <ul class="packing-list">
                        <li><label class="packing-item"><input type="checkbox"><span>Maillots de bain (x2 √† x3)</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Shorts / robes l√©g√®res / t-shirts respirants</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Rashguard ou t-shirt anti-UV (snorkeling)</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Serviette microfibre + sac √©tanche</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Sandales / tongs + chaussures aquatiques</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Chapeau / casquette + lunettes polaris√©es</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Cr√®me solaire SPF50 + apr√®s-soleil</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Anti-moustiques tropiques</span></label></li>
                    </ul>
                    <div class="packing-tags">
                        <span class="packing-tag">Panglao</span>
                        <span class="packing-tag">Balicasag</span>
                        <span class="packing-tag">Plong√©e</span>
                    </div>
                </div>

                <div class="packing-card">
                    <h3>üéí Excursions & activit√©s</h3>
                    <ul class="packing-list">
                        <li><label class="packing-item"><input type="checkbox"><span>Sac √† dos de journ√©e</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Gourde isotherme</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Petite trousse de secours (pansements, antiseptique)</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>M√©dicaments personnels + anti-maux de transport</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Imperm√©able compact / poncho</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Lampe frontale (cascades / sorties t√¥t)</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Snacks / barres √©nerg√©tiques</span></label></li>
                    </ul>
                    <div class="packing-tags">
                        <span class="packing-tag">Cascades</span>
                        <span class="packing-tag">Chocolate Hills</span>
                        <span class="packing-tag">Danao Park</span>
                    </div>
                </div>

                <div class="packing-card">
                    <h3>üìÑ Documents & argent</h3>
                    <ul class="packing-list">
                        <li><label class="packing-item"><input type="checkbox"><span>Passeports + copies papier & num√©riques</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Billets d'avion + r√©servations h√¥tels</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Assurance voyage + contacts d'urgence</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Permis international (si besoin)</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Cartes bancaires + un peu de cash (JPY/PHP)</span></label></li>
                    </ul>
                    <div class="packing-tags">
                        <span class="packing-tag">Vols</span>
                        <span class="packing-tag">Transferts</span>
                    </div>
                </div>

                <div class="packing-card">
                    <h3>üîå Tech & confort</h3>
                    <ul class="packing-list">
                        <li><label class="packing-item"><input type="checkbox"><span>Adaptateur prise Japon + Philippines</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Batterie externe + c√¢bles</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Appareil photo / GoPro + √©tui √©tanche</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>√âcouteurs + petit coussin de voyage</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Masque de sommeil + bouchons d'oreilles</span></label></li>
                        <li><label class="packing-item"><input type="checkbox"><span>Carte SIM/eSIM locale ou pocket Wi-Fi</span></label></li>
                    </ul>
                    <div class="packing-tags">
                        <span class="packing-tag">Vols longs</span>
                        <span class="packing-tag">Plong√©e</span>
                    </div>
                </div>
            </div>
        </section>

        <section id="lexicon" class="section">
            <h2 style="margin-bottom:15px;">üó£Ô∏è Lexique utile (Japon)</h2>
            <p style="margin-bottom:15px; color:#64748b;">Phrases courtes pour le restaurant, konbini, rue, transport et politesse.</p>
            <input id="lexicon-search" class="lexicon-search" type="search" placeholder="Rechercher une expression (ex: gare, addition, aide...)" aria-label="Rechercher dans le lexique">
            <p id="lexicon-empty" class="lexicon-empty">Aucun r√©sultat pour cette recherche.</p>
            <div class="lexicon-grid">
                <div class="lexicon-card">
                    <h3>üçú Restaurant</h3>
                    <ul class="lexicon-list">
                        <li><span class="lexicon-jp">Sumimasen</span><span class="lexicon-fr">Excusez-moi / pour appeler le serveur.</span></li>
                        <li><span class="lexicon-jp">Kore o kudasai</span><span class="lexicon-fr">Je prends √ßa, s'il vous pla√Æt.</span></li>
                        <li><span class="lexicon-jp">Osusume wa nan desu ka?</span><span class="lexicon-fr">Quelle est votre recommandation ?</span></li>
                        <li><span class="lexicon-jp">Okaikei onegaishimasu</span><span class="lexicon-fr">L'addition, s'il vous pla√Æt.</span></li>
                        <li><span class="lexicon-jp">Mizu o onegaishimasu</span><span class="lexicon-fr">De l'eau, s'il vous pla√Æt.</span></li>
                        <li><span class="lexicon-jp">Kono ryouri wa nan desu ka?</span><span class="lexicon-fr">C'est quoi ce plat ?</span></li>
                        <li><span class="lexicon-jp">Bejitarian menu wa arimasu ka?</span><span class="lexicon-fr">Avez-vous un menu v√©g√©tarien ?</span></li>
                    </ul>
                </div>
                <div class="lexicon-card">
                    <h3>üè™ Konbini</h3>
                    <ul class="lexicon-list">
                        <li><span class="lexicon-jp">Atatamemasu ka?</span><span class="lexicon-fr">Vous voulez que je r√©chauffe ?</span></li>
                        <li><span class="lexicon-jp">Hai, onegaishimasu</span><span class="lexicon-fr">Oui, s'il vous pla√Æt.</span></li>
                        <li><span class="lexicon-jp">Fukuro wa irimasen</span><span class="lexicon-fr">Je n'ai pas besoin de sac.</span></li>
                        <li><span class="lexicon-jp">Kore wa doko desu ka?</span><span class="lexicon-fr">O√π est cet article ?</span></li>
                        <li><span class="lexicon-jp">Toire wa doko desu ka?</span><span class="lexicon-fr">O√π sont les toilettes ?</span></li>
                        <li><span class="lexicon-jp">Kurejitto kaado wa tsukaemasu ka?</span><span class="lexicon-fr">Est-ce que je peux payer par carte ?</span></li>
                        <li><span class="lexicon-jp">Ohashi o futatsu kudasai</span><span class="lexicon-fr">Deux paires de baguettes, s'il vous pla√Æt.</span></li>
                    </ul>
                </div>
                <div class="lexicon-card">
                    <h3>üß≠ Rue & transport</h3>
                    <ul class="lexicon-list">
                        <li><span class="lexicon-jp">___ eki wa doko desu ka?</span><span class="lexicon-fr">O√π est la gare ___ ?</span></li>
                        <li><span class="lexicon-jp">Koko ni ikitai desu</span><span class="lexicon-fr">Je veux aller ici.</span></li>
                        <li><span class="lexicon-jp">Densha wa nan-ji desu ka?</span><span class="lexicon-fr">Le train est √† quelle heure ?</span></li>
                        <li><span class="lexicon-jp">Arigatou gozaimasu</span><span class="lexicon-fr">Merci beaucoup.</span></li>
                        <li><span class="lexicon-jp">Kono densha wa Kyoto ni ikimasu ka?</span><span class="lexicon-fr">Ce train va √† Kyoto ?</span></li>
                        <li><span class="lexicon-jp">Norikae wa doko desu ka?</span><span class="lexicon-fr">O√π faire la correspondance ?</span></li>
                        <li><span class="lexicon-jp">Kippu wa doko de kaemasu ka?</span><span class="lexicon-fr">O√π puis-je acheter un billet ?</span></li>
                    </ul>
                </div>
                <div class="lexicon-card">
                    <h3>üí¨ Urgences & aide</h3>
                    <ul class="lexicon-list">
                        <li><span class="lexicon-jp">Eigo wa hanasemasu ka?</span><span class="lexicon-fr">Parlez-vous anglais ?</span></li>
                        <li><span class="lexicon-jp">Tasukete kudasai</span><span class="lexicon-fr">Aidez-moi, s'il vous pla√Æt.</span></li>
                        <li><span class="lexicon-jp">Daijoubu desu</span><span class="lexicon-fr">Tout va bien.</span></li>
                        <li><span class="lexicon-jp">Byouin wa doko desu ka?</span><span class="lexicon-fr">O√π est l'h√¥pital ?</span></li>
                        <li><span class="lexicon-jp">Kega o shimashita</span><span class="lexicon-fr">Je me suis bless√©(e).</span></li>
                        <li><span class="lexicon-jp">Kusuri wa arimasu ka?</span><span class="lexicon-fr">Avez-vous des m√©dicaments ?</span></li>
                        <li><span class="lexicon-jp">Yukkuri hanashite kudasai</span><span class="lexicon-fr">Parlez lentement, s'il vous pla√Æt.</span></li>
                    </ul>
                </div>
            </div>
        </section>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        /* --- CONFIG --- */
        const DATE_DEPART = new Date('2026-02-20T18:50:00');
        
        /* --- STATES --- */
        let realUserLocation = null;
        let userMarker = null;
        
        /* --- DONN√âES VOYAGE --- */
        const voyageData = {
            days: [
                { id: 1, date: new Date('2026-02-20'), country: 'International', location: 'Paris ‚Üí Istanbul ‚Üí Tokyo', coords: [48.8566, 2.3522], hotel: { name: "Nuit √† bord", room: "Vol Turkish Airlines", link: "#" }, challenge: { title: "‚úàÔ∏è D√©part", desc: "Photo du d√©collage", hint: "Porte d'embarquement" }, activities: [
                    { time: "14:50", title: "D√©part domicile", desc: "Trajet vers CDG", coords: [48.8566, 2.3522] },
                    { time: "18:50", title: "Vol Paris ‚Üí Istanbul", desc: "TK1828", coords: [49.0097, 2.5479] },
                    { time: "02:30", title: "Vol Istanbul ‚Üí Tokyo", desc: "TK198", coords: [41.2753, 28.7519] }
                ], suggestions: [] },
                { id: 2, date: new Date('2026-02-21'), country: 'Japon', location: 'Tokyo (Ginza)', coords: [35.6712, 139.7665], hotel: { name: "The B Ginza", room: "Check-in tardif", link: "https://www.google.com/maps/search/?api=1&query=The+B+Ginza" }, challenge: { title: "üåÉ Arriv√©e Tokyo", desc: "Premi√®re soir√©e √† Ginza", hint: "Sortie Haneda" }, activities: [
                    { time: "19:45", title: "Arriv√©e Haneda", desc: "Atterrissage", coords: [35.5494, 139.7798] },
                    { time: "20:30", title: "D√©part vers Ginza", desc: "Transport vers l'h√¥tel", coords: [35.5494, 139.7798] },
                    { time: "22:00", title: "Check-in The B Ginza", desc: "Installation", coords: [35.6712, 139.7665] },
                    { time: "22:30", title: "D√Æner l√©ger", desc: "Konbini / snack", coords: [35.6712, 139.7665] }
                ], suggestions: [] },
                { id: 3, date: new Date('2026-02-22'), country: 'Japon', location: 'Tokyo (Asakusa & Ueno)', coords: [35.7148, 139.7967], hotel: { name: "The B Ginza", room: "Nuit Tokyo", link: "https://www.google.com/maps/search/?api=1&query=The+B+Ginza" }, challenge: { title: "‚õ©Ô∏è Asakusa", desc: "Photo √† Senso-ji", hint: "Kaminarimon" }, activities: [
                    { time: "08:30", title: "D√©part h√¥tel", desc: "Vers Asakusa", coords: [35.6712, 139.7665] },
                    { time: "09:00", title: "Senso-ji + Asakusa-jinja", desc: "Tokyo traditionnel", coords: [35.7148, 139.7967] },
                    { time: "10:30", title: "Rue Nakamise", desc: "Balade & souvenirs", coords: [35.7119, 139.7964] },
                    { time: "11:00", title: "Kappabashi", desc: "Quartier cuisine", coords: [35.7090, 139.7908] },
                    { time: "12:00", title: "D√©jeuner Ameyoko", desc: "Ueno market", coords: [35.7088, 139.7746] },
                    { time: "13:00", title: "Parc Ueno", desc: "√âtang + Bentendo", coords: [35.7140, 139.7741] },
                    { time: "15:00", title: "Nezu-jinja", desc: "Torii rouges", coords: [35.7165, 139.7615] },
                    { time: "20:00", title: "D√Æner omakase", desc: "R√©servation confirm√©e", coords: [35.6712, 139.7665] }
                ], suggestions: [] },
                { id: 4, date: new Date('2026-02-23'), country: 'Japon', location: 'Tokyo (Ginza/Odaiba)', coords: [35.6586, 139.7454], hotel: { name: "The B Ginza", room: "Nuit Tokyo", link: "https://www.google.com/maps/search/?api=1&query=The+B+Ginza" }, challenge: { title: "üëë Tokyo classique + futuriste", desc: "Photo au Palais Imp√©rial", hint: "Kokyo Gaien" }, activities: [
                    { time: "09:30", title: "D√©part Ginza", desc: "Shopping + Tsukiji", coords: [35.6712, 139.7665] },
                    { time: "13:00", title: "Palais Imp√©rial", desc: "Jardins Est", coords: [35.6852, 139.7528] },
                    { time: "16:30", title: "TeamLab Planets", desc: "Entr√©e r√©serv√©e", coords: [35.6490, 139.7890] },
                    { time: "18:15", title: "D√©part Odaiba", desc: "Coucher de soleil", coords: [35.6272, 139.7768] }
                ], suggestions: [] },
                { id: 5, date: new Date('2026-02-24'), country: 'Japon', location: 'Tokyo (Shibuya/Shinjuku)', coords: [35.6595, 139.7005], hotel: { name: "The B Ginza", room: "Derni√®re nuit Tokyo", link: "https://www.google.com/maps/search/?api=1&query=The+B+Ginza" }, challenge: { title: "üî• Tokyo n√©on", desc: "Photo au Shibuya Crossing", hint: "Vue en hauteur" }, activities: [
                    { time: "09:30", title: "D√©part Meiji-jingu", desc: "Parc Yoyogi + Harajuku", coords: [35.6764, 139.6993] },
                    { time: "12:00", title: "Shibuya", desc: "Sky + crossing + Miyashita", coords: [35.6595, 139.7005] },
                    { time: "15:30", title: "Shinjuku Gyoen", desc: "Pause verte", coords: [35.6852, 139.7100] },
                    { time: "18:30", title: "D√©part Shinjuku night", desc: "Gov building + Kabukicho", coords: [35.6938, 139.7034] }
                ], suggestions: [] },
                { id: 6, date: new Date('2026-02-25'), country: 'Japon', location: 'Tokyo ‚Üí Furano', coords: [43.3421, 142.3832], hotel: { name: "Winery Hotel Furano", room: "Check-in Hitohana", link: "https://www.google.com/maps/search/?api=1&query=Winery+Hotel+Furano" }, challenge: { title: "‚ùÑÔ∏è Direction Hokkaido", desc: "Photo arriv√©e Furano", hint: "Devant l'h√¥tel" }, activities: [
                    { time: "11:10", title: "Vol Tokyo ‚Üí Asahikawa", desc: "D√©part HND", coords: [35.5494, 139.7798] },
                    { time: "13:30", title: "Train vers Furano", desc: "Transfert gare", coords: [43.7706, 142.3650] },
                    { time: "16:00", title: "Check-in h√¥tel", desc: "Soir√©e d√©tente", coords: [43.3421, 142.3832] }
                ], suggestions: [] },
                { id: 7, date: new Date('2026-02-26'), country: 'Japon', location: 'Furano', coords: [43.3421, 142.3832], hotel: { name: "Winery Hotel Furano", room: "S√©jour ski", link: "https://www.google.com/maps/search/?api=1&query=Winery+Hotel+Furano" }, challenge: { title: "‚õ∑Ô∏è Ski day 1", desc: "Photo piste", hint: "Sommet" }, activities: [
                    { time: "08:30", title: "D√©part ski", desc: "Session matin", coords: [43.3400, 142.3800] },
                    { time: "16:30", title: "Onsen", desc: "R√©cup√©ration", coords: [43.3421, 142.3832] },
                    { time: "19:00", title: "D√Æner", desc: "Fromagerie & vin", coords: [43.3421, 142.3832] }
                ], suggestions: [] },
                { id: 8, date: new Date('2026-02-27'), country: 'Japon', location: 'Furano', coords: [43.3421, 142.3832], hotel: { name: "Winery Hotel Furano", room: "S√©jour ski", link: "https://www.google.com/maps/search/?api=1&query=Winery+Hotel+Furano" }, challenge: { title: "üå≤ Ningle Terrace", desc: "Photo ambiance neige", hint: "Lanternes" }, activities: [
                    { time: "08:30", title: "D√©part ski", desc: "Journ√©e glisse", coords: [43.3400, 142.3800] },
                    { time: "17:30", title: "Ningle Terrace", desc: "Balade bois√©e", coords: [43.3316, 142.3558] },
                    { time: "19:00", title: "Ski nocturne", desc: "Option 27/28", coords: [43.3400, 142.3800] }
                ], suggestions: [] },
                { id: 9, date: new Date('2026-02-28'), country: 'Japon', location: 'Furano', coords: [43.3421, 142.3832], hotel: { name: "Winery Hotel Furano", room: "S√©jour ski", link: "https://www.google.com/maps/search/?api=1&query=Winery+Hotel+Furano" }, challenge: { title: "üç∑ Furano slow day", desc: "Photo fromagerie", hint: "D√©gustation" }, activities: [
                    { time: "08:30", title: "D√©part ski", desc: "Matin√©e", coords: [43.3400, 142.3800] },
                    { time: "16:30", title: "Onsen", desc: "D√©tente", coords: [43.3421, 142.3832] },
                    { time: "19:00", title: "D√Æner", desc: "Sp√©cialit√©s locales", coords: [43.3421, 142.3832] }
                ], suggestions: [] },
                { id: 10, date: new Date('2026-03-01'), country: 'Japon', location: 'Furano', coords: [43.3421, 142.3832], hotel: { name: "Winery Hotel Furano", room: "Derni√®re nuit Hokkaido", link: "https://www.google.com/maps/search/?api=1&query=Winery+Hotel+Furano" }, challenge: { title: "üßò Ralentir", desc: "Photo repos", hint: "Moment calme" }, activities: [
                    { time: "09:00", title: "D√©part ski l√©ger", desc: "Derni√®res descentes", coords: [43.3400, 142.3800] },
                    { time: "15:00", title: "Repos", desc: "Pr√©paration transfert", coords: [43.3421, 142.3832] }
                ], suggestions: [] },
                { id: 11, date: new Date('2026-03-02'), country: 'Japon', location: 'Furano ‚Üí Kyoto', coords: [35.0116, 135.7681], hotel: { name: "Insomnia Kyoto Oike", room: "Check-in", link: "https://www.google.com/maps/search/?api=1&query=Insomnia+Kyoto+Oike" }, challenge: { title: "üèØ Arriv√©e Kyoto", desc: "Photo soir√©e tranquille", hint: "Quartier Oike" }, activities: [
                    { time: "07:30", title: "D√©part vers a√©roport", desc: "Transfert Furano", coords: [43.3421, 142.3832] },
                    { time: "14:00", title: "Vol Sapporo ‚Üí Osaka", desc: "D√©part", coords: [42.7752, 141.6923] },
                    { time: "17:00", title: "Bus vers Kyoto", desc: "Dernier transfert", coords: [34.7855, 135.4382] },
                    { time: "18:30", title: "Check-in h√¥tel", desc: "Soir√©e libre", coords: [35.0116, 135.7681] }
                ], suggestions: [] },
                { id: 12, date: new Date('2026-03-03'), country: 'Japon', location: 'Kyoto iconique', coords: [35.0116, 135.7681], hotel: { name: "Insomnia Kyoto Oike", room: "Nuit Kyoto", link: "https://www.google.com/maps/search/?api=1&query=Insomnia+Kyoto+Oike" }, challenge: { title: "üå∏ Kyoto romantique", desc: "Photo √† Kiyomizu-dera", hint: "Terrasse" }, activities: [
                    { time: "09:00", title: "Kinkaku-ji", desc: "Temple d'or", coords: [35.0394, 135.7292] },
                    { time: "10:30", title: "Ryoan-ji", desc: "Jardin zen", coords: [35.0345, 135.7182] },
                    { time: "12:00", title: "March√© Nishiki", desc: "Pause midi", coords: [35.0048, 135.7643] },
                    { time: "13:15", title: "Kennin-ji", desc: "Temple", coords: [35.0010, 135.7765] },
                    { time: "14:30", title: "D√©part Gion & Yasaka", desc: "Ruelles historiques", coords: [35.0037, 135.7788] },
                    { time: "15:30", title: "Kiyomizu-dera", desc: "Incontournable", coords: [34.9949, 135.7850] },
                    { time: "17:15", title: "Kyoto Tower", desc: "Coucher du soleil", coords: [34.9876, 135.7593] }
                ], suggestions: [] },
                { id: 13, date: new Date('2026-03-04'), country: 'Japon', location: 'Nara', coords: [34.6851, 135.8048], hotel: { name: "Insomnia Kyoto Oike", room: "Retour Kyoto", link: "https://www.google.com/maps/search/?api=1&query=Insomnia+Kyoto+Oike" }, challenge: { title: "ü¶å Nara day", desc: "Photo avec les cerfs", hint: "Parc de Nara" }, activities: [
                    { time: "07:30", title: "D√©part Kyoto", desc: "Train vers Nara", coords: [35.0116, 135.7681] },
                    { time: "08:30", title: "Kasuga Taisha", desc: "Sanctuaire", coords: [34.6815, 135.8488] },
                    { time: "10:15", title: "Todai-ji", desc: "Grand Bouddha", coords: [34.6890, 135.8398] },
                    { time: "11:45", title: "Nigatsu-do", desc: "Point de vue", coords: [34.6913, 135.8427] },
                    { time: "13:00", title: "Mochi Nakatanidou", desc: "Pause gourmande", coords: [34.6831, 135.8272] },
                    { time: "15:30", title: "Retour Kyoto", desc: "D√Æner libre", coords: [35.0116, 135.7681] }
                ], suggestions: [] },
                { id: 14, date: new Date('2026-03-05'), country: 'Japon', location: 'Kyoto ‚Üí Osaka', coords: [34.6937, 135.5023], hotel: { name: "H√¥tel Osaka", room: "Nuit Osaka", link: "https://www.google.com/maps/search/?api=1&query=Hotel+Osaka+Namba" }, challenge: { title: "üèØ Osaka", desc: "Photo ch√¢teau", hint: "Parc Osaka-jo" }, activities: [
                    { time: "07:00", title: "Fushimi Inari", desc: "Torii t√¥t le matin", coords: [34.9671, 135.7727] },
                    { time: "13:00", title: "D√©part Osaka", desc: "Trajet depuis Kyoto", coords: [35.0116, 135.7681] },
                    { time: "14:30", title: "Ch√¢teau d'Osaka", desc: "Visite", coords: [34.6873, 135.5262] },
                    { time: "19:30", title: "Namba / Dotonbori", desc: "Soir√©e", coords: [34.6687, 135.5019] }
                ], suggestions: [] },
                { id: 15, date: new Date('2026-03-06'), country: 'Japon', location: 'Osaka ‚Üí Manille', coords: [14.5995, 120.9842], hotel: { name: "Vol de nuit", room: "Vers Manille", link: "#" }, challenge: { title: "üåè Cap Philippines", desc: "Photo dernier spot Japon", hint: "A√©roport KIX" }, activities: [
                    { time: "09:00", title: "Kuromon Market", desc: "Street food", coords: [34.6654, 135.5057] },
                    { time: "11:30", title: "Temple Katsuo-ji", desc: "Daruma", coords: [34.8669, 135.4696] },
                    { time: "16:30", title: "D√©part vers KIX", desc: "Check-in vol", coords: [34.4342, 135.2440] },
                    { time: "19:35", title: "Vol Osaka ‚Üí Manille", desc: "D√©collage", coords: [34.4342, 135.2440] }
                ], suggestions: [] },
                { id: 16, date: new Date('2026-03-07'), country: 'Philippines', location: 'Panglao', coords: [9.55, 123.77], hotel: { name: "Fox & The Firefly", room: "Cottage", link: "https://www.google.com/maps/search/?api=1&query=Fox+and+The+Firefly+Bohol" }, challenge: { title: "üå¥ Panglao", desc: "Photo cascade", hint: "Dimiao" }, activities: [
                    { time: "06:55", title: "Arriv√©e Panglao", desc: "D√©but s√©jour Philippines", coords: [9.5780, 123.8425] },
                    { time: "09:00", title: "D√©part cascades", desc: "Dimiao + Can-Umantad", coords: [9.9000, 124.1500] },
                    { time: "17:00", title: "Kayak lucioles", desc: "Soir√©e magique", coords: [9.6385, 124.0300] }
                ], suggestions: [] },
                { id: 17, date: new Date('2026-03-08'), country: 'Philippines', location: 'Bohol Nature', coords: [9.8297, 124.1397], hotel: { name: "Fox & The Firefly", room: "Cottage", link: "https://www.google.com/maps/search/?api=1&query=Fox+and+The+Firefly+Bohol" }, challenge: { title: "üç´ Bohol", desc: "Photo Chocolate Hills", hint: "Belv√©d√®re" }, activities: [
                    { time: "09:00", title: "Chocolate Hills", desc: "D√©part excursion", coords: [9.8297, 124.1397] },
                    { time: "10:30", title: "Tarsiers", desc: "Sanctuaire", coords: [9.6918, 124.0096] },
                    { time: "13:00", title: "Danao Park", desc: "Nature & aventure", coords: [9.9407, 124.1878] },
                    { time: "16:00", title: "Man Made Forest", desc: "Route panoramique", coords: [9.7330, 124.0700] }
                ], suggestions: [] },
                { id: 18, date: new Date('2026-03-09'), country: 'Philippines', location: 'Amorita Resort', coords: [9.5483, 123.7764], hotel: { name: "Amorita Resort", room: "Suite Luxe", link: "https://www.google.com/maps/search/?api=1&query=Amorita+Resort+Bohol" }, challenge: { title: "üíõ Slow honeymoon", desc: "Photo plage", hint: "Alona Beach" }, activities: [
                    { time: "07:00", title: "Plong√©e Balicasag", desc: "Option matin", coords: [9.5191, 123.6811] },
                    { time: "17:00", title: "Massage", desc: "Fin d'apr√®s-midi", coords: [9.5483, 123.7764] },
                    { time: "19:30", title: "D√Æner romantique plage", desc: "Soir√©e", coords: [9.5483, 123.7764] }
                ], suggestions: [] },
                { id: 19, date: new Date('2026-03-10'), country: 'Philippines', location: 'Amorita Resort', coords: [9.5483, 123.7764], hotel: { name: "Amorita Resort", room: "Suite Luxe", link: "https://www.google.com/maps/search/?api=1&query=Amorita+Resort+Bohol" }, challenge: { title: "üèùÔ∏è Journ√©e d√©tente", desc: "Photo coucher de soleil", hint: "Plage" }, activities: [
                    { time: "10:00", title: "Massage", desc: "Matin√©e d√©tente", coords: [9.5483, 123.7764] },
                    { time: "13:00", title: "Plage", desc: "Alona Beach", coords: [9.5483, 123.7764] },
                    { time: "19:30", title: "D√Æner libre", desc: "Mode slow", coords: [9.5483, 123.7764] }
                ], suggestions: [] },
                { id: 20, date: new Date('2026-03-11'), country: 'Philippines', location: 'Amorita Resort', coords: [9.5483, 123.7764], hotel: { name: "Amorita Resort", room: "Suite Luxe", link: "https://www.google.com/maps/search/?api=1&query=Amorita+Resort+Bohol" }, challenge: { title: "üê† Mer & spa", desc: "Photo snorkeling", hint: "Balicasag" }, activities: [
                    { time: "08:00", title: "Plong√©e sous-marine", desc: "Sortie en mer", coords: [9.5191, 123.6811] },
                    { time: "16:00", title: "Retour √† l'h√¥tel", desc: "Chill au resort", coords: [9.5483, 123.7764] },
                    { time: "19:30", title: "D√Æner romantique", desc: "Plage", coords: [9.5483, 123.7764] }
                ], suggestions: [] },
                { id: 21, date: new Date('2026-03-12'), country: 'Philippines', location: 'Amorita Resort', coords: [9.5483, 123.7764], hotel: { name: "Amorita Resort", room: "Derni√®re nuit", link: "https://www.google.com/maps/search/?api=1&query=Amorita+Resort+Bohol" }, challenge: { title: "‚ú® Dernier jour", desc: "Photo finale resort", hint: "Vue mer" }, activities: [
                    { time: "09:00", title: "Matin√©e libre", desc: "Repos total", coords: [9.5483, 123.7764] },
                    { time: "17:00", title: "Pr√©paration d√©part", desc: "Bagages", coords: [9.5483, 123.7764] }
                ], suggestions: [] },
                { id: 22, date: new Date('2026-03-13'), country: 'International', location: 'Panglao ‚Üí Manille ‚Üí Duba√Ø', coords: [14.51, 121.01], hotel: { name: "Nuit √† bord", room: "Vol retour", link: "#" }, challenge: { title: "üëã Retour", desc: "Derni√®re photo des Philippines", hint: "A√©roport" }, activities: [
                    { time: "18:50", title: "Vol Panglao ‚Üí Manille", desc: "D√©part", coords: [9.5780, 123.8425] },
                    { time: "23:30", title: "Vol Manille ‚Üí Duba√Ø", desc: "Long-courrier", coords: [14.51, 121.01] }
                ], suggestions: [] },
                { id: 23, date: new Date('2026-03-14'), country: 'France', location: 'Duba√Ø ‚Üí Paris', coords: [48.8566, 2.3522], hotel: { name: "Maison", room: "Retour", link: "#" }, challenge: { title: "üè† Paris", desc: "Fin du voyage", hint: "Arriv√©es CDG" }, activities: [
                    { time: "07:50", title: "Vol Duba√Ø ‚Üí Paris", desc: "D√©part", coords: [25.2532, 55.3657] },
                    { time: "12:25", title: "Arriv√©e Paris", desc: "Fin de lune de miel", coords: [49.0097, 2.5479] }
                ], suggestions: [] }
            ],
            hotels: [
                { 
                    name: "The B Ginza", 
                    city: "Tokyo", 
                    stars: 4, 
                    coords: [35.6695, 139.7615], 
                    phone: "+81335431200", 
                    website: "https://www.theb-hotels.com/theb/ginza",
                    checkIn: "15:00", 
                    checkOut: "11:00", 
                    amenities: ["Wifi", "Caf√© gratuit", "Clim", "Centre ville"], 
                    desc: "H√¥tel moderne au c≈ìur du quartier chic de Ginza. Id√©al pour le shopping et les d√Æners."
                },
                { 
                    name: "Winery Hotel Furano", 
                    city: "Furano", 
                    stars: 4, 
                    coords: [43.3421, 142.3832], 
                    phone: "+81167238778", 
                    website: "https://hotel-hitohana.com/",
                    checkIn: "15:00", 
                    checkOut: "10:00", 
                    amenities: ["Onsen", "Vue Montagne", "Navette Ski", "Restaurant"], 
                    desc: "H√¥tel perch√© avec vue panoramique sur les montagnes et vignobles."
                },
                { 
                    name: "Insomnia KYOTO OIKE", 
                    city: "Kyoto", 
                    stars: 4, 
                    coords: [35.0116, 135.7600], 
                    phone: "+81752217700", 
                    website: "https://www.inso-mnia.com/kyoto/",
                    checkIn: "14:00", 
                    checkOut: "11:00", 
                    amenities: ["Design", "Wifi", "Bar 24h", "Central"], 
                    desc: "H√¥tel moderne et artistique id√©alement situ√© pr√®s du march√© Nishiki et des transports."
                },
                { 
                    name: "Centara Grand Hotel", 
                    city: "Osaka", 
                    stars: 5, 
                    coords: [34.6595, 135.5009], 
                    phone: "+81666169945", 
                    website: "https://www.centarahotelsresorts.com/centaragrand/fr/cgoj",
                    checkIn: "14:00", 
                    checkOut: "12:00", 
                    amenities: ["Spa", "Piscine", "Vue ville", "Restaurants"], 
                    desc: "H√¥tel de luxe au centre d'Osaka avec vue imprenable et services haut de gamme."
                },
                { 
                    name: "Fox & The Firefly", 
                    city: "Loboc", 
                    stars: 3, 
                    coords: [9.6378, 124.0331], 
                    phone: "+63384220700", 
                    website: "https://www.foxandthefireflycottages.com/",
                    checkIn: "14:00", 
                    checkOut: "12:00", 
                    amenities: ["Eco-Lodge", "Bord rivi√®re", "Nature", "Paddle"], 
                    desc: "Cottages en bambou au bord de la rivi√®re Loboc. Ambiance nature et d√©connect√©e."
                },
                { 
                    name: "Amorita Resort", 
                    city: "Panglao", 
                    stars: 5, 
                    coords: [9.5483, 123.7764], 
                    phone: "+63289319999", 
                    website: "https://www.amoritaresort.com/amoritabohol",
                    checkIn: "14:00", 
                    checkOut: "12:00", 
                    amenities: ["Infinity Pool", "Plage priv√©e", "Spa", "Plong√©e"], 
                    desc: "Luxe discret sur une falaise surplombant la plage d'Alona. Calme et volupt√©."
                }
            ]
        };

        let currentDayIndex = 0;
        let map = null;
        let exchangeRates = { "EUR-JPY": 162.50, "JPY-EUR": 0.0061, "EUR-PHP": 61.20, "PHP-EUR": 0.016 };

        document.addEventListener('DOMContentLoaded', () => {
            startCountdown();
            renderDayNav();
            renderDay(0);
            renderHotels();
            setupSwipe();
            initGeo(); 
            renderOverview(); 
            renderFlights(); 
            initLexiconSearch();
        });

        /* --- GEOLOCATION --- */
        function initGeo() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    (pos) => {
                        realUserLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                        if (map) updateUserMarker();
                    },
                    (err) => console.log("GPS Error", err),
                    { enableHighAccuracy: true }
                );
            }
        }

        /* --- COMPTE √Ä REBOURS --- */
        function startCountdown() {
            const update = () => {
                const now = new Date().getTime();
                const distance = DATE_DEPART.getTime() - now;
                if (distance < 0) {
                    document.getElementById('countdown-display').innerHTML = "<h3>EN VOYAGE ! ‚úàÔ∏è</h3>";
                    document.getElementById("header-date").innerText = "J-0";
                    return;
                }
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById("cd-days").innerText = days < 10 ? "0"+days : days;
                document.getElementById("cd-hours").innerText = hours < 10 ? "0"+hours : hours;
                document.getElementById("cd-minutes").innerText = minutes < 10 ? "0"+minutes : minutes;
                document.getElementById("header-date").innerText = "J-" + days;
            };
            setInterval(update, 1000);
            update();
        }

        /* --- NAVIGATION --- */
        function navigate(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            toggleSidebar();
            
            if(id === 'map' && map) {
                setTimeout(() => map.invalidateSize(), 200);
                updateUserMarker();
            }
            if(id === 'converter') updateRates();
        }
        
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            const overlay = document.querySelector('.sidebar-overlay');
            if(overlay) overlay.style.display = document.getElementById('sidebar').classList.contains('active') ? 'block' : 'none';
        }

        function initLexiconSearch() {
            const input = document.getElementById('lexicon-search');
            const items = Array.from(document.querySelectorAll('#lexicon .lexicon-list li'));
            const emptyState = document.getElementById('lexicon-empty');
            if (!input || items.length === 0 || !emptyState) return;

            const normalize = (value) => value
                .toLowerCase()
                .normalize('NFD')
                .replace(/[ÃÄ-ÕØ]/g, '');

            items.forEach((item) => {
                item.dataset.search = normalize(item.innerText);
            });

            const applyFilter = () => {
                const query = normalize(input.value.trim());
                let visibleCount = 0;

                items.forEach((item) => {
                    const show = query === '' || item.dataset.search.includes(query);
                    item.classList.toggle('hidden', !show);
                    if (show) visibleCount += 1;
                });

                emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
            };

            input.addEventListener('input', applyFilter);
            applyFilter();
        }

        /* --- OVERVIEW LOGIC --- */
        function renderOverview() {
            const container = document.getElementById('overview-container');
            
            container.innerHTML = voyageData.days.map(d => {
                const morningActs = d.activities.filter(a => parseInt(a.time.split(':')[0]) < 12);
                const afternoonActs = d.activities.filter(a => parseInt(a.time.split(':')[0]) >= 12);

                return `
                <div class="overview-day" onclick="selectDay(${d.id-1}); navigate('planner')">
                    <div class="overview-date">${d.date.toLocaleDateString('fr-FR', {weekday:'short', day:'numeric', month:'short'})}</div>
                    <div class="overview-loc"><i class="fas fa-map-pin"></i> ${d.location}</div>
                    
                    <div class="overview-split-header"><i class="fas fa-sun" style="color:#fbc02d;"></i> Matin</div>
                    <ul class="overview-act-list">
                        ${morningActs.length > 0 ? morningActs.map(a => `<li class="overview-act-item">${a.time} - ${a.title}</li>`).join('') : '<li class="overview-empty-slot">Repos / Libre</li>'}
                    </ul>

                    <div class="overview-split-header"><i class="fas fa-moon" style="color:#5c6bc0;"></i> Apr√®s-midi</div>
                    <ul class="overview-act-list">
                        ${afternoonActs.length > 0 ? afternoonActs.map(a => `<li class="overview-act-item">${a.time} - ${a.title}</li>`).join('') : '<li class="overview-empty-slot">Repos / Libre</li>'}
                    </ul>
                </div>`;
            }).join('');
        }

        function scrollOverview(direction) {
            const container = document.getElementById('overview-container');
            const scrollAmount = container.clientWidth * 0.85; 
            
            if(direction === 'left') {
                container.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
            } else {
                container.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }
        }

        /* --- FLIGHTS LOGIC --- */
        function renderFlights() {
            const flightItinerary = [
                {
                    title: "D√©part de Paris : France ‚Üí Japon",
                    date: "20 F√©vrier 2026",
                    baggage: [
                        {
                            people: ["PA", "Coralie"],
                            details: "2 valises en soute de 23 kg + 1 valise cabine jusqu'√† 8 kg."
                        }
                    ],
                    flights: [
                        {
                            depCode: "CDG", depCity: "Paris", depTime: "18:50",
                            arrCode: "IST", arrCity: "Istanbul", arrTime: "23:30",
                            flightNum: "TK1828", airline: "Turkish Airlines"
                        },
                        {
                            depCode: "IST", depCity: "Istanbul", depTime: "02:30",
                            arrCode: "HND", arrCity: "Tokyo", arrTime: "19:45",
                            flightNum: "TK198", airline: "Turkish Airlines", nextDay: true
                        }
                    ]
                },
                {
                    title: "Objectif neige : Tokyo ‚Üí Hokkaido",
                    date: "25 F√©vrier 2026",
                    baggage: [
                        {
                            people: ["PA", "Coralie"],
                            details: "1 valise en soute de 20 kg + 1 bagage cabine de 10 kg."
                        }
                    ],
                    flights: [
                        {
                            depCode: "HND", depCity: "Tokyo", depTime: "11:10",
                            arrCode: "AKJ", arrCity: "Asahikawa", arrTime: "12:50",
                            flightNum: "JAL553", airline: "JAL"
                        }
                    ]
                },
                {
                    title: "Vol vers Kyoto: Hokkaido ‚Üí Kansai",
                    date: "02 Mars 2026",
                    baggage: [
                        {
                            people: ["PA", "Coralie"],
                            details: "1 valise en soute de 20 kg + 1 bagage cabine de 10 kg."
                        }
                    ],
                    flights: [
                        {
                            depCode: "CTS", depCity: "Sapporo", depTime: "14:00",
                            arrCode: "ITM", arrCity: "Osaka", arrTime: "16:05",
                            flightNum: "ANA984", airline: "ANA"
                        }
                    ]
                },
                {
                    title: "Au Soleil! : Japon ‚Üí Philippines",
                    date: "06 Mars 2026",
                    baggage: [
                        {
                            person: "PA",
                            details: "2 valises en soute de 20 kg + 1 bagage cabine de 7 kg."
                        },
                        {
                            person: "Coralie",
                            details: "1 valise en soute de 20 kg + 1 bagage cabine de 7 kg."
                        }
                    ],
                    flights: [
                        {
                            depCode: "KIX", depCity: "Osaka", depTime: "19:35",
                            arrCode: "MNL", arrCity: "Manille", arrTime: "23:15",
                            flightNum: "PR411", airline: "Philippine Airlines"
                        },
                        {
                            depCode: "MNL", depCity: "Manille", depTime: "05:20",
                            arrCode: "TAG", arrCity: "Panglao", arrTime: "06:55",
                            flightNum: "PR2773", airline: "PAL Express", nextDay: true
                        }
                    ]
                },
                {
                    title: "Patounes en approche : Philippines ‚Üí France",
                    date: "13 Mars 2026",
                    baggage: [
                        {
                            people: ["PA", "Coralie"],
                            details: "1 valise en soute de 25 kg + 1 bagage cabine de 7 kg."
                        }
                    ],
                    flights: [
                        {
                            depCode: "TAG", depCity: "Panglao", depTime: "18:50",
                            arrCode: "MNL", arrCity: "Manille", arrTime: "20:25",
                            flightNum: "PR2778", airline: "PAL Express"
                        },
                        {
                            depCode: "MNL", depCity: "Manille", depTime: "23:30",
                            arrCode: "DXB", arrCity: "Dubai", arrTime: "04:45",
                            flightNum: "EK335", airline: "Emirates", nextDay: true
                        },
                        {
                            depCode: "DXB", depCity: "Dubai", depTime: "07:50",
                            arrCode: "CDG", arrCity: "Paris", arrTime: "12:25",
                            flightNum: "EK073", airline: "Emirates"
                        }
                    ]
                }
            ];

            const container = document.getElementById('flights-container');
            
            container.innerHTML = flightItinerary.map(trip => `
                <div class="flight-trip-card">
                    <div class="flight-trip-header">
                        <div class="flight-trip-title"><i class="fas fa-plane-departure"></i> ${trip.title}</div>
                        <div class="flight-trip-date">${trip.date}</div>
                    </div>
                    ${trip.baggage ? `
                        <div class="flight-baggage">
                            <strong>Bagages :</strong>
                            <ul>
                                ${[...trip.baggage].sort((a, b) => {
                                    const order = { "PA": 0, "Coralie": 1 };
                                    const aKey = a.person || (a.people ? a.people[0] : "");
                                    const bKey = b.person || (b.people ? b.people[0] : "");
                                    return (order[aKey] ?? 99) - (order[bKey] ?? 99);
                                }).map(item => {
                                    const people = item.people || (item.person ? [item.person] : []);
                                    const orderedPeople = [...people].sort((a, b) => {
                                        const order = { "PA": 0, "Coralie": 1 };
                                        return (order[a] ?? 99) - (order[b] ?? 99);
                                    });
                                    const icons = orderedPeople.map(person => {
                                        const className = person === "PA" ? "baggage-pa" : "baggage-coralie";
                                        return `<span class="baggage-icon ${className}"><i class="fas fa-suitcase-rolling"></i>${person}</span>`;
                                    }).join('');
                                    return `
                                        <li>
                                            <div class="baggage-icons">
                                                ${icons}
                                            </div>
                                            <div class="baggage-details">${item.details}</div>
                                        </li>
                                    `;
                                }).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    ${trip.flights.map(segment => `
                        <div class="flight-segment">
                            <div class="flight-times-col">
                                <div class="flight-time">${segment.depTime}</div>
                                <div class="flight-time-sub">${segment.depCode}</div>
                                
                                <div style="flex:1; min-height:20px; border-right:2px dashed #ccc; margin-right:-2px;"></div>
                                
                                <div class="flight-time">${segment.arrTime} ${segment.nextDay ? '<sup style="color:#e91e63; font-size:0.6rem;">+1</sup>' : ''}</div>
                                <div class="flight-time-sub">${segment.arrCode}</div>
                            </div>
                            <div class="flight-info-col">
                                <div class="flight-route">
                                    <strong>${segment.depCity}</strong> <span>‚úà</span> <strong>${segment.arrCity}</strong>
                                </div>
                                <div class="flight-airline">
                                    <i class="fas fa-ticket-alt"></i> ${segment.airline}
                                    <span class="flight-badge">${segment.flightNum}</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        /* --- PLANNING --- */
        function renderDayNav() {
            const select = document.getElementById('day-select');
            select.innerHTML = "";
            voyageData.days.forEach((day, index) => {
                const opt = document.createElement('option');
                opt.value = index;
                opt.text = `Jour ${day.id} - ${day.date.toLocaleDateString('fr-FR', {day:'numeric', month:'short'})}`;
                select.appendChild(opt);
            });
        }

        function selectDay(index, direction = null) { 
            currentDayIndex = parseInt(index); 
            renderDay(currentDayIndex, direction);
        }
        
        function changeDay(offset, direction = null) {
            let newIndex = currentDayIndex + offset;
            if(newIndex >= 0 && newIndex < voyageData.days.length) {
                if (!direction) direction = offset > 0 ? 'right' : 'left';
                selectDay(newIndex, direction);
                document.getElementById('day-select').value = newIndex;
            }
        }

        function renderDay(index, direction = null) {
            const day = voyageData.days[index];
            const container = document.getElementById('day-content');
            const themeClass = day.country === 'Japon' ? 'bg-jp' : (day.country === 'Philippines' ? 'bg-ph' : 'bg-intl');
            const isChallengeDone = localStorage.getItem('challenge_'+day.id) === 'true';
            
            let animClass = '';
            if (direction === 'right') animClass = 'slide-in-right';
            if (direction === 'left') animClass = 'slide-in-left';

            let suggestionsHtml = "";
            if(day.suggestions && day.suggestions.length > 0) {
                suggestionsHtml = `
                    <div style="margin-top:20px; background:#fff3e0; padding:15px; border-radius:12px; border-left:4px solid var(--suggestion);">
                        <h4 style="margin-bottom:10px; color:#e65100; font-size:1rem;"><i class="fas fa-lightbulb"></i> Id√©es temps libre</h4>
                        ${day.suggestions.map(s => `<div style="margin-bottom:8px; font-size:0.95rem;"><strong><a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.title + " " + day.location)}" target="_blank" class="map-link">${s.title} <i class="fas fa-external-link-alt map-icon-small"></i></a></strong>: ${s.desc}</div>`).join('')}
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="day-card ${animClass}">
                    <div class="day-header ${themeClass}">
                        <div>
                            <h2 style="font-size:1.4rem;">${day.date.toLocaleDateString('fr-FR', {weekday: 'long', day: 'numeric', month: 'long'})}</h2>
                            <p style="font-size:1rem; opacity:0.9;"><i class="fas fa-map-marker-alt"></i> ${day.location}, ${day.country}</p>
                        </div>
                        <i class="fas ${day.country === 'Japon' ? 'fa-torii-gate' : (day.country === 'Philippines' ? 'fa-sun' : 'fa-plane')} fa-2x"></i>
                    </div>
                    
                    <div class="challenge-card ${isChallengeDone ? 'completed' : ''}" id="chal-${day.id}">
                        <div class="challenge-header" onclick="this.nextElementSibling.classList.toggle('open')">
                            <i class="fas fa-camera" style="font-size:1.2rem;"></i> 
                            <strong style="flex:1; font-size:1rem;">${isChallengeDone ? 'Souvenir cr√©√© !' : day.challenge.title}</strong>
                            ${isChallengeDone ? 
                                `<button onclick="event.stopPropagation(); undoChallenge(${day.id})" class="undo-btn"><i class="fas fa-trash"></i></button>` : 
                                '<i class="fas fa-chevron-down"></i>'
                            }
                        </div>
                        <div class="challenge-body">
                            <p style="font-size:0.95rem; line-height:1.4;">${day.challenge.desc}</p>
                            <div style="background:rgba(255,255,255,0.1); padding:10px; border-radius:8px; margin:10px 0; font-size:0.85rem;">
                                üí° ${day.challenge.hint}
                            </div>
                            ${!isChallengeDone ? `
                                <label class="camera-btn-label">
                                    <i class="fas fa-camera" style="font-size:1.5rem; color:var(--primary);"></i> Ouvrir l'appareil photo
                                    <input type="file" accept="image/*" capture="environment" style="display:none" onchange="handleCamera(event, ${day.id})">
                                </label>` 
                            : ''}
                        </div>
                    </div>

                    <div class="timeline">
                        ${day.activities.map(act => `
                            <div class="activity">
                                <div style="color:var(--primary);font-weight:bold; font-size:0.9rem;">${act.time}</div>
                                <strong style="font-size:1rem;">
                                    <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(act.title + " " + day.location)}" target="_blank" class="map-link">
                                        ${act.title} <i class="fas fa-external-link-alt map-icon-small"></i>
                                    </a>
                                </strong>
                                <p style="font-size:0.9rem; color:#666; margin-top:2px;">${act.desc}</p>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${suggestionsHtml}

                    <div class="hotel-card">
                        <strong>üè® <a href="${day.hotel.link}" target="_blank" class="map-link" style="font-size:1.05rem;">${day.hotel.name} <i class="fas fa-external-link-alt map-icon-small"></i></a></strong><br>
                        <span style="font-size:0.95rem; color:#555;">${day.hotel.room}</span>
                    </div>
                </div>
            `;
        }

        function completeChallenge(id) {
            localStorage.setItem('challenge_'+id, 'true');
            renderDay(currentDayIndex);
            if(navigator.vibrate) navigator.vibrate(200);
        }

        function undoChallenge(id) {
            if(confirm("Voulez-vous vraiment annuler ce d√©fi ?")) {
                localStorage.removeItem('challenge_'+id);
                renderDay(currentDayIndex);
            }
        }

        function handleCamera(event, id) {
            if (event.target.files && event.target.files.length > 0) {
                completeChallenge(id);
            }
        }
        
        function renderHotels() {
             const list = document.getElementById('hotels-list');
             if (list) {
                 list.innerHTML = voyageData.hotels.map(h => `
                    <div class="day-card" style="padding:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h3 style="margin:0; font-size:1.2rem;">${h.name}</h3>
                            <div style="color:#fbc02d; font-size:0.9rem;">${"‚≠ê".repeat(h.stars)}</div>
                        </div>
                        <p style="color:#666; margin:5px 0; font-size:0.95rem;"><i class="fas fa-map-pin"></i> ${h.city}</p>
                        <p style="font-size:0.95rem; margin-bottom:15px; line-height:1.4;">${h.desc}</p>
                        
                        <div class="hotel-details">
                            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                                <span>üïí In: <strong>${h.checkIn}</strong></span>
                                <span>Out: <strong>${h.checkOut}</strong></span>
                            </div>
                            <div style="margin-top:8px;">
                                ${h.amenities.map(a => `<span class="hotel-badge">${a}</span>`).join('')}
                            </div>
                        </div>
                        
                        <!-- BOUTONS D'ACTION POUR L'H√îTEL -->
                        <div class="hotel-actions">
                            <a href="tel:${h.phone}" class="hotel-action-btn hotel-call-btn">
                                <i class="fas fa-phone"></i> Appeler
                            </a>
                            <a href="${h.website}" target="_blank" class="hotel-action-btn hotel-website-btn">
                                <i class="fas fa-globe"></i> Site Web
                            </a>
                            <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(h.name + ' ' + h.city)}" target="_blank" class="hotel-action-btn hotel-map-btn">
                                <i class="fas fa-map-marked-alt"></i> Localiser
                            </a>
                        </div>
                        
                        <div style="margin-top:15px; padding-top:15px; border-top:1px solid #eee; font-size:0.85rem; color:#666;">
                            <i class="fas fa-phone-alt"></i> <strong>T√©l√©phone:</strong> 
                            <a href="tel:${h.phone}" style="color:var(--primary); text-decoration:none; font-weight:bold;">
                                ${formatPhoneNumber(h.phone)}
                            </a>
                        </div>
                    </div>
                 `).join('');
             }
        }
        
        /* Fonction pour formater les num√©ros de t√©l√©phone */
        function formatPhoneNumber(phone) {
            if (!phone) return "Non disponible";
            
            // Format international : +33 1 23 45 67 89
            const cleaned = phone.replace(/\D/g, '');
            
            if (cleaned.startsWith('81')) { // Japon
                return phone;
            } else if (cleaned.startsWith('63')) { // Philippines
                return phone;
            } else if (cleaned.startsWith('33')) { // France
                return phone;
            }
            
            return phone;
        }

        function initMap() {
            if(map) return;
            map = L.map('map-container', {zoomControl: false}).setView([25, 130], 4);
            L.control.zoom({position: 'bottomright'}).addTo(map);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: ''}).addTo(map);
            
            voyageData.hotels.forEach(h => {
                if(h.coords) {
                    const icon = L.divIcon({
                        className: 'custom-div-icon',
                        html: `<div class="marker-pin" style="background:#2196f3;"><i class="fas fa-bed"></i></div>`,
                        iconSize: [30, 42], iconAnchor: [15, 42]
                    });
                    L.marker(h.coords, {icon: icon}).addTo(map).bindPopup(`<b>${h.name}</b><br>H√¥tel`);
                }
            });

            voyageData.days.forEach(d => {
                d.activities.forEach(act => {
                    if(act.coords) {
                         const iconAct = L.divIcon({
                            className: 'custom-div-icon',
                            html: `<div class="marker-pin" style="background:#e91e63;"><i class="fas fa-camera"></i></div>`,
                            iconSize: [30, 42], iconAnchor: [15, 42]
                        });
                        L.marker(act.coords, {icon: iconAct}).addTo(map).bindPopup(`<b>Jour ${d.id}: ${act.title}</b><br>${act.desc}`);
                    }
                });
                if(d.suggestions) {
                    d.suggestions.forEach(s => {
                        const iconSugg = L.divIcon({
                            className: 'custom-div-icon',
                            html: `<div class="marker-pin" style="background:#ff9800;"><i class="fas fa-lightbulb"></i></div>`,
                            iconSize: [30, 42], iconAnchor: [15, 42]
                        });
                        L.marker(s.coords, {icon: iconSugg}).addTo(map).bindPopup(`<b>Suggestion: ${s.title}</b><br>${s.desc}`);
                    });
                }
            });
            
            updateUserMarker();
        }
        
        function updateUserMarker() {
            if (!map) return;
            
            const now = new Date();
            const tripStart = voyageData.days[0].date;
            const tripEnd = voyageData.days[voyageData.days.length - 1].date;
            
            const tripEndBuffer = new Date(tripEnd);
            tripEndBuffer.setDate(tripEndBuffer.getDate() + 1);

            const isDuringTrip = now >= tripStart && now < tripEndBuffer;

            if (realUserLocation && isDuringTrip) {
                if (userMarker) {
                    userMarker.setLatLng([realUserLocation.lat, realUserLocation.lng]);
                } else {
                    const userIcon = L.divIcon({
                        className: 'custom-div-icon',
                        html: `<div class="user-pin"></div>`,
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    });
                    userMarker = L.marker([realUserLocation.lat, realUserLocation.lng], {icon: userIcon}).addTo(map).bindPopup("Vous √™tes ici üìç");
                }
            }
        }
        
        /* --- CONVERTISSEUR --- */
        async function updateRates() {
            const btn = document.getElementById('btn-update-rates');
            const info = document.getElementById('rate-info');
            if(!btn) return;
            
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRLLj3YWEjnNtTwjxM_6CZCB354sMQFQNaW0JkldsHsr-NFn7nHXQ6oxM73bUuuEbPMxTftpnkHb7fy/pub?gid=0&single=true&output=csv';
            
            try {
                const response = await fetch(sheetUrl);
                const text = await response.text();
                const rows = text.split('\n').map(row => {
                    const cols = row.split(',');
                    return cols.length > 1 ? parseFloat(cols[1]) : parseFloat(cols[0]);
                });
                if (rows.length >= 4) {
                    exchangeRates["EUR-JPY"] = rows[0]; exchangeRates["JPY-EUR"] = rows[1];
                    exchangeRates["EUR-PHP"] = rows[2]; exchangeRates["PHP-EUR"] = rows[3];
                    
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.style.background = "var(--success)";
                    info.innerText = "Mis √† jour √† " + new Date().toLocaleTimeString().slice(0,5);
                    convertCurrency();
                    setTimeout(() => { btn.innerHTML = originalText; btn.style.background = "var(--secondary)"; }, 2000);
                }
            } catch (error) {
                console.error("Erreur taux:", error);
                btn.innerHTML = '<i class="fas fa-times"></i>';
                btn.style.background = "#f44336";
                setTimeout(() => { btn.innerHTML = originalText; btn.style.background = "var(--secondary)"; }, 2000);
            }
        }

        function convertCurrency() {
            const amount = parseFloat(document.getElementById('amount-from').value);
            const from = document.getElementById('curr-from').value;
            const to = document.getElementById('curr-to').value;
            const resultDiv = document.getElementById('conversion-result');
            if (isNaN(amount)) { resultDiv.innerText = "---"; return; }
            if (from === to) { resultDiv.innerText = amount.toFixed(2); return; }
            let rate = 0;
            const pair = `${from}-${to}`;
            if (exchangeRates[pair]) { rate = exchangeRates[pair]; } 
            else {
                const toEuro = `${from}-EUR`; const fromEuro = `EUR-${to}`;
                if (exchangeRates[toEuro] && exchangeRates[fromEuro]) { rate = exchangeRates[toEuro] * exchangeRates[fromEuro]; }
            }
            if (rate > 0) { resultDiv.innerText = (amount * rate).toFixed(2); } 
            else { resultDiv.innerText = "?"; }
        }

        function swapCurrency() {
            const fromEl = document.getElementById('curr-from');
            const toEl = document.getElementById('curr-to');
            const temp = fromEl.value; fromEl.value = toEl.value; toEl.value = temp;
            convertCurrency();
        }

        /* --- UTILS --- */
        function setupSwipe() {
            const container = document.getElementById('day-content');
            let touchStartX = 0; let touchEndX = 0; const minSwipeDistance = 50;
            container.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
            container.addEventListener('touchend', e => { touchEndX = e.changedTouches[0].screenX; handleSwipe(container, 'day'); }, {passive: true});
            
            const overviewContainer = document.getElementById('overview-container');
            let touchStartOverview = 0;
            overviewContainer.addEventListener('touchstart', e => { touchStartOverview = e.changedTouches[0].screenX; }, {passive: true});

            function handleSwipe(el, mode) {
                const distance = touchEndX - touchStartX;
                if (Math.abs(distance) < minSwipeDistance) return;
                if (distance > 0) { if(mode==='day') changeDay(-1, 'left'); } 
                else { if(mode==='day') changeDay(1, 'right'); }
            }
        }

        function enterApp() {
            document.getElementById('landing-page').style.transform = 'translateY(-100%)';
            document.getElementById('app-interface').style.display = 'block';
            setTimeout(() => { document.getElementById('app-interface').style.opacity = '1'; initMap(); }, 500);
        }
    </script>
</body>
</html>
